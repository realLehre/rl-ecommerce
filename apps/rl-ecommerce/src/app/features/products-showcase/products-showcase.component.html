<div class="relative w-full">
  @if (products$ | async; as productArray) {
    @if (productArray.products.length) {
      <header class="flex items-center mb-7">
        <button
          class="flex min-[760px]:hidden items-center space-x-1 cursor-pointer text-type_grey relative"
          (click)="onOpenMobileFilter()"
        >
          <span class="text-sm">Filter by</span>
          <svg
            width="16"
            height="17"
            viewBox="0 0 16 17"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M14.6666 12.9033C14.6666 13.0359 14.6139 13.1631 14.5201 13.2569C14.4264 13.3506 14.2992 13.4033 14.1666 13.4033H10.7666C10.6552 13.8186 10.41 14.1855 10.0689 14.4472C9.72776 14.7089 9.30984 14.8507 8.87992 14.8507C8.44999 14.8507 8.03208 14.7089 7.69097 14.4472C7.34986 14.1855 7.10461 13.8186 6.99325 13.4033H1.83325C1.70064 13.4033 1.57347 13.3506 1.4797 13.2569C1.38593 13.1631 1.33325 13.0359 1.33325 12.9033C1.33325 12.7707 1.38593 12.6435 1.4797 12.5498C1.57347 12.456 1.70064 12.4033 1.83325 12.4033H6.99325C7.10461 11.9881 7.34986 11.6212 7.69097 11.3595C8.03208 11.0978 8.44999 10.956 8.87992 10.956C9.30984 10.956 9.72776 11.0978 10.0689 11.3595C10.41 11.6212 10.6552 11.9881 10.7666 12.4033H14.1666C14.2992 12.4033 14.4264 12.456 14.5201 12.5498C14.6139 12.6435 14.6666 12.7707 14.6666 12.9033ZM14.6666 4.09666C14.6666 4.22927 14.6139 4.35645 14.5201 4.45021C14.4264 4.54398 14.2992 4.59666 14.1666 4.59666H12.5333C12.4219 5.01191 12.1766 5.37882 11.8355 5.64051C11.4944 5.90219 11.0765 6.04403 10.6466 6.04403C10.2167 6.04403 9.79875 5.90219 9.45764 5.64051C9.11653 5.37882 8.87128 5.01191 8.75992 4.59666H1.83325C1.76759 4.59666 1.70257 4.58373 1.64191 4.5586C1.58125 4.53347 1.52613 4.49664 1.4797 4.45021C1.43327 4.40379 1.39644 4.34867 1.37131 4.288C1.34618 4.22734 1.33325 4.16232 1.33325 4.09666C1.33325 4.031 1.34618 3.96598 1.37131 3.90532C1.39644 3.84466 1.43327 3.78954 1.4797 3.74311C1.52613 3.69668 1.58125 3.65985 1.64191 3.63472C1.70257 3.60959 1.76759 3.59666 1.83325 3.59666H8.75992C8.87128 3.18141 9.11653 2.8145 9.45764 2.55281C9.79875 2.29113 10.2167 2.14929 10.6466 2.14929C11.0765 2.14929 11.4944 2.29113 11.8355 2.55281C12.1766 2.8145 12.4219 3.18141 12.5333 3.59666H14.1666C14.2325 3.59576 14.2979 3.60808 14.359 3.63289C14.4201 3.6577 14.4755 3.6945 14.5221 3.74111C14.5687 3.78772 14.6055 3.8432 14.6304 3.90426C14.6552 3.96533 14.6675 4.03075 14.6666 4.09666ZM14.6666 8.49666C14.6675 8.56257 14.6552 8.62799 14.6304 8.68906C14.6055 8.75013 14.5687 8.8056 14.5221 8.85221C14.4755 8.89882 14.4201 8.93562 14.359 8.96043C14.2979 8.98524 14.2325 8.99756 14.1666 8.99666H6.36659C6.25522 9.41191 6.00998 9.77882 5.66887 10.0405C5.32776 10.3022 4.90984 10.444 4.47992 10.444C4.04999 10.444 3.63208 10.3022 3.29097 10.0405C2.94986 9.77882 2.70461 9.41191 2.59325 8.99666H1.83325C1.70064 8.99666 1.57347 8.94398 1.4797 8.85021C1.38593 8.75645 1.33325 8.62927 1.33325 8.49666C1.33325 8.36405 1.38593 8.23688 1.4797 8.14311C1.57347 8.04934 1.70064 7.99666 1.83325 7.99666H2.59325C2.70461 7.58141 2.94986 7.2145 3.29097 6.95281C3.63208 6.69113 4.04999 6.54929 4.47992 6.54929C4.90984 6.54929 5.32776 6.69113 5.66887 6.95281C6.00998 7.2145 6.25522 7.58141 6.36659 7.99666H14.1666C14.2992 7.99666 14.4264 8.04934 14.5201 8.14311C14.6139 8.23688 14.6666 8.36405 14.6666 8.49666Z"
              fill="#555555"
            />
          </svg>

          <span
            class="absolute -top-2 -right-2 h-4 w-4 flex items-center justify-center bg-primary text-white p-2 text-[10px] font-medium rounded-full"
            >{{ numberOfFilters() }}</span
          >
        </button>
        <p class="text-xs ml-auto tablet:text-base justify-self-end">
          Showing {{ config()?.currentPage! | itemsShowing }} â€“
          {{ config()?.currentPage! | itemsShowing: config()?.totalItems }}
          of {{ config()?.totalItems }} results
        </p>
      </header>
    }
    <app-mobile-filters
      class="fixed min-[760px]:hidden w-full left-0 bottom-0 h-1/2 translate-y-[100%] z-[110] transition-all ease-in-out"
      [ngClass]="{ '!translate-y-0': isMobileFilterOpened() }"
    />

    <div>
      <div class="grid grid-cols-2 min-[1050px]:grid-cols-3 gap-x-6 gap-y-10">
        @for (
          product of productArray.products | paginate: config()!;
          track product.id
        ) {
          <app-product-card [product]="product" />
        }
      </div>

      @if (!productArray.products.length) {
        <div class="text-center w-full">
          <h3 class="text-base mobile:text-lg font-medium">
            No products are available
          </h3>
        </div>
      }
    </div>

    @if (productArray.products.length) {
      <div class="hidden mobile:flex justify-center items-center w-full mt-12">
        <pagination-template
          #p="paginationApi"
          [id]="config()?.id!"
          (pageChange)="pageChange($event)"
          class="h-fit min-h-auto"
        >
          <div class="flex items-center text-sm">
            <button
              class="h-8 w-8 flex items-center border-0 outline-0 justify-center cursor-pointer disabled:opacity-30"
              [disabled]="p.isFirstPage()"
              (click)="p.previous()"
              [attr.aria-label]="'Previous page'"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 448 512"
                class="w-6"
              >
                <path
                  d="M7.4 273.4C2.7 268.8 0 262.6 0 256s2.7-12.8 7.4-17.4l176-168c9.6-9.2 24.8-8.8 33.9 .8s8.8 24.8-.8 33.9L83.9 232 424 232c13.3 0 24 10.7 24 24s-10.7 24-24 24L83.9 280 216.6 406.6c9.6 9.2 9.9 24.3 .8 33.9s-24.3 9.9-33.9 .8l-176-168z"
                />
              </svg>
            </button>

            @for (page of p.pages; track $index) {
              <button
                class="flex items-center justify-center mx-2 w-9 h-9 rounded-full text-type_title_gray cursor-pointer font-bold bg-transparent"
                [ngClass]="{
                  'text-white !bg-primary': p.getCurrent() === page.value,
                }"
                (click)="p.setCurrent(page.value)"
                [attr.aria-label]="'Page {{ page.label }}'"
              >
                <span>{{ page.label }}</span>
              </button>
            }

            <button
              class="h-8 w-8 flex items-center border-0 outline-0 justify-center cursor-pointer disabled:opacity-30"
              [disabled]="p.isLastPage()"
              (click)="p.next()"
              [attr.aria-label]="'Next page'"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 448 512"
                class="w-6 rotate-180"
              >
                <path
                  d="M7.4 273.4C2.7 268.8 0 262.6 0 256s2.7-12.8 7.4-17.4l176-168c9.6-9.2 24.8-8.8 33.9 .8s8.8 24.8-.8 33.9L83.9 232 424 232c13.3 0 24 10.7 24 24s-10.7 24-24 24L83.9 280 216.6 406.6c9.6 9.2 9.9 24.3 .8 33.9s-24.3 9.9-33.9 .8l-176-168z"
                />
              </svg>
            </button>
          </div>
        </pagination-template>
      </div>

      <div
        class="flex mobile:hidden items-center justify-between space-x-3 max-w-[230px] mx-auto mt-10"
      >
        <button
          class="h-8 w-8 flex items-center border-0 outline-0 justify-center cursor-pointer disabled:opacity-30"
          [disabled]="config()?.currentPage! === 1"
          (click)="pageChange(config()?.currentPage! - 1)"
          [attr.aria-label]="'Previous page'"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 448 512"
            class="w-6"
          >
            <path
              d="M7.4 273.4C2.7 268.8 0 262.6 0 256s2.7-12.8 7.4-17.4l176-168c9.6-9.2 24.8-8.8 33.9 .8s8.8 24.8-.8 33.9L83.9 232 424 232c13.3 0 24 10.7 24 24s-10.7 24-24 24L83.9 280 216.6 406.6c9.6 9.2 9.9 24.3 .8 33.9s-24.3 9.9-33.9 .8l-176-168z"
            />
          </svg>
        </button>

        <div
          class="p-2 bg-primary bg-opacity-60 h-12 rounded flex items-center justify-center space-x-2 text-white font-medium"
        >
          <span
            class="h-8 flex items-center justify-center px-5 bg-primary rounded"
            >{{ config()?.currentPage! }}</span
          >
          <div class="space-x-1">
            <span>of</span>
            <span>{{ productArray.totalPages }}</span>
          </div>
        </div>

        <button
          class="h-8 w-8 flex items-center border-0 outline-0 justify-center cursor-pointer disabled:opacity-30"
          [disabled]="config()?.currentPage! === productArray.totalPages"
          (click)="pageChange(config()?.currentPage! + 1)"
          [attr.aria-label]="'Next page'"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 448 512"
            class="w-6 rotate-180"
          >
            <path
              d="M7.4 273.4C2.7 268.8 0 262.6 0 256s2.7-12.8 7.4-17.4l176-168c9.6-9.2 24.8-8.8 33.9 .8s8.8 24.8-.8 33.9L83.9 232 424 232c13.3 0 24 10.7 24 24s-10.7 24-24 24L83.9 280 216.6 406.6c9.6 9.2 9.9 24.3 .8 33.9s-24.3 9.9-33.9 .8l-176-168z"
            />
          </svg>
        </button>
      </div>
    }
  } @else {
    <header class="flex items-center mb-7">
      <div
        class="flex min-[760px]:hidden items-center space-x-1 cursor-pointer text-type_grey relative"
      >
        <p-skeleton width="68px" height="2rem" />
      </div>
      <div class="ml-auto justify-self-end">
        <p-skeleton width="120px" height="2rem" />
      </div>
    </header>
    <div class="grid grid-cols-2 min-[1050px]:grid-cols-3 gap-x-6 gap-y-10">
      @for (t of [1, 2, 3, 4, 5, 6]; track t) {
        <div class="flex flex-col space-y-1 mobile:space-y-3">
          <div class="relative w-full h-[180px] mobile:h-[230px]">
            <div
              class="absolute top-0 left-0 w-full h-full clip-polygon z-[100]"
              style="
                clip-path: polygon(
                  0 18%,
                  25% 0,
                  100% 0,
                  100% 82%,
                  75% 100%,
                  0% 100%
                );
              "
            >
              <p-skeleton width="100%" height="100%" />
            </div>
          </div>

          <div class="w-full">
            <div class="w-full mb-2">
              <p-skeleton width="100%" height="2rem" />
            </div>

            <div class="mb-4">
              <p-skeleton width="70%" height="1rem" />
            </div>

            <div class="flex items-center justify-between gap-x-2 gap-y-4">
              <div class="flex-1">
                <p-skeleton width="100%" height="2rem" />
              </div>

              <div class="flex-1">
                <p-skeleton width="100%" height="3rem" />
              </div>
            </div>
          </div>
        </div>
      }
    </div>
  }
</div>
